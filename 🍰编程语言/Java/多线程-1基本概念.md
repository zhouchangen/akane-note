# å¤šçº¿ç¨‹ - åŸºæœ¬æ¦‚å¿µ

ç³»ç»Ÿå­¦ä¹ å¤šçº¿ç¨‹çŸ¥è¯†



## è¿›ç¨‹ä¸çº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ

### è¿›ç¨‹

è¿›ç¨‹å°±æ˜¯**åº”ç”¨ç¨‹åºåœ¨å†…å­˜ä¸­åˆ†é…çš„ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œçš„ç¨‹åº**ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚åŒæ—¶è¿›ç¨‹ä¿å­˜ç€ç¨‹åºæ¯ä¸€ä¸ªæ—¶åˆ»è¿è¡Œçš„çŠ¶æ€ã€‚



CPUé‡‡ç”¨**æ—¶é—´ç‰‡è½®è½¬**çš„æ–¹å¼è¿è¡Œè¿›ç¨‹ï¼šCPUä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªæ—¶é—´æ®µï¼Œç§°ä½œå®ƒçš„æ—¶é—´ç‰‡ã€‚å¦‚æœåœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œåˆ™æš‚åœè¿™ä¸ªè¿›ç¨‹çš„è¿è¡Œï¼Œå¹¶ä¸”CPUåˆ†é…ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆè¿™ä¸ªè¿‡ç¨‹å«åš**ä¸Šä¸‹æ–‡åˆ‡æ¢**ï¼‰ã€‚å¦‚æœè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸå‰é˜»å¡æˆ–ç»“æŸï¼Œåˆ™CPUç«‹å³è¿›è¡Œåˆ‡æ¢ï¼Œä¸ç”¨ç­‰å¾…æ—¶é—´ç‰‡ç”¨å®Œã€‚



ä½¿ç”¨è¿›ç¨‹+CPUæ—¶é—´ç‰‡è½®è½¬æ–¹å¼çš„æ“ä½œç³»ç»Ÿï¼Œåœ¨å®è§‚ä¸Šçœ‹èµ·æ¥åŒä¸€æ—¶é—´æ®µæ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæ¢å¥è¯è¯´ï¼Œ**è¿›ç¨‹è®©æ“ä½œç³»ç»Ÿçš„å¹¶å‘æˆä¸ºäº†å¯èƒ½**ã€‚è™½ç„¶å¹¶å‘ä»å®è§‚ä¸Šçœ‹æœ‰å¤šä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œä½†åœ¨äº‹å®ä¸Šï¼Œå¯¹äº**å•æ ¸CPU**æ¥è¯´ï¼Œ**ä»»æ„å…·ä½“æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªä»»åŠ¡åœ¨å ç”¨CPUèµ„æºã€‚**



### çº¿ç¨‹

é‚£ä¹ˆèƒ½ä¸èƒ½è®©è¿™äº›å­ä»»åŠ¡åŒæ—¶æ‰§è¡Œå‘¢ï¼Ÿäºæ˜¯äººä»¬åˆæå‡ºäº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œ**è®©ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ä¸ªå­ä»»åŠ¡ï¼Œè¿™æ ·ä¸€ä¸ªè¿›ç¨‹å°±åŒ…å«äº†å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£ä¸€ä¸ªå•ç‹¬çš„å­ä»»åŠ¡ã€‚**



### è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«

è¿›ç¨‹è®©æ“ä½œç³»ç»Ÿçš„å¹¶å‘æ€§æˆä¸ºäº†å¯èƒ½ï¼Œè€Œçº¿ç¨‹è®©è¿›ç¨‹çš„å†…éƒ¨å¹¶å‘æˆä¸ºäº†å¯èƒ½ã€‚



è¿›ç¨‹æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œç¯å¢ƒï¼Œè€Œçº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­æ‰§è¡Œçš„ä¸€ä¸ªä»»åŠ¡ã€‚ä»–ä»¬ä¸¤ä¸ªæœ¬è´¨çš„åŒºåˆ«æ˜¯**æ˜¯å¦å•ç‹¬å æœ‰å†…å­˜åœ°å€ç©ºé—´åŠå…¶å®ƒç³»ç»Ÿèµ„æºï¼ˆæ¯”å¦‚I/Oï¼‰**ï¼š

- è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹é—´å­˜åœ¨**å†…å­˜éš”ç¦»**ï¼Œæ•°æ®æ˜¯åˆ†å¼€çš„ï¼Œæ•°æ®å…±äº«å¤æ‚ä½†æ˜¯åŒæ­¥ç®€å•ï¼Œå„ä¸ªè¿›ç¨‹ä¹‹é—´äº’ä¸å¹²æ‰°ï¼›è€Œ**çº¿ç¨‹å…±äº«**æ‰€å±è¿›ç¨‹å æœ‰çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œæ•°æ®å…±äº«ç®€å•ï¼Œä½†æ˜¯åŒæ­¥å¤æ‚ã€‚
- è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªè¿›ç¨‹å‡ºç°é—®é¢˜ä¸ä¼šå½±å“å…¶ä»–è¿›ç¨‹ï¼Œä¸å½±å“ä¸»ç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§é«˜ï¼›ä¸€ä¸ªçº¿ç¨‹å´©æºƒå¯èƒ½å½±å“æ•´ä¸ªç¨‹åºçš„ç¨³å®šæ€§ï¼Œå¯é æ€§è¾ƒä½ã€‚
- è¿›ç¨‹å•ç‹¬å æœ‰ä¸€å®šçš„å†…å­˜åœ°å€ç©ºé—´ï¼Œè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯ä¸ä»…éœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œè¿˜éœ€è¦èµ„æºçš„åˆ†é…å›æ”¶ä»¥åŠé¡µè°ƒåº¦ï¼Œå¼€é”€è¾ƒå¤§ï¼›çº¿ç¨‹åªéœ€è¦ä¿å­˜å¯„å­˜å™¨å’Œæ ˆä¿¡æ¯ï¼Œå¼€é”€è¾ƒå°ã€‚

å¦å¤–ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯ï¼Œ**è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½**ï¼Œå³CPUåˆ†é…æ—¶é—´çš„å•ä½ ã€‚



**å¤šè¿›ç¨‹çš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°å¹¶å‘ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ**

å¤šè¿›ç¨‹æ–¹å¼ç¡®å®å¯ä»¥å®ç°å¹¶å‘ï¼Œä½†ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

- **è¿›ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå¤æ‚**ï¼Œè€Œçº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒç®€å•ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…±äº«èµ„æºï¼Œè¿™äº›èµ„æºåœ¨çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¾ƒå®¹æ˜“ã€‚
- è¿›ç¨‹æ˜¯**é‡é‡çº§**çš„ï¼Œè€Œçº¿ç¨‹æ˜¯è½»é‡çº§çš„ï¼Œæ•…å¤šçº¿ç¨‹æ–¹å¼çš„**ç³»ç»Ÿå¼€é”€æ›´å°**ã€‚



### ä¸Šä¸‹æ–‡åˆ‡æ¢

ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆæœ‰æ—¶ä¹Ÿç§°åšè¿›ç¨‹åˆ‡æ¢æˆ–ä»»åŠ¡åˆ‡æ¢ï¼‰æ˜¯æŒ‡ CPU ä»ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ã€‚ä¸Šä¸‹æ–‡æ˜¯æŒ‡**æŸä¸€æ—¶é—´ç‚¹ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨çš„å†…å®¹ã€‚**



å¯„å­˜å™¨æ˜¯cpuå†…éƒ¨çš„å°‘é‡çš„é€Ÿåº¦å¾ˆå¿«çš„é—ªå­˜ï¼Œé€šå¸¸å­˜å‚¨å’Œè®¿é—®è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´å€¼æé«˜è®¡ç®—æœºç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚

ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€ä¸ªä¸“ç”¨çš„å¯„å­˜å™¨ï¼Œç”¨äºè¡¨æ˜æŒ‡ä»¤åºåˆ—ä¸­ CPU æ­£åœ¨æ‰§è¡Œçš„ä½ç½®ï¼Œå­˜çš„å€¼ä¸ºæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®æˆ–è€…ä¸‹ä¸€ä¸ªå°†è¦è¢«æ‰§è¡Œçš„æŒ‡ä»¤çš„ä½ç½®ï¼Œå…·ä½“å®ç°ä¾èµ–äºç‰¹å®šçš„ç³»ç»Ÿã€‚



ä¸¾ä¾‹è¯´æ˜ çº¿ç¨‹A - B

1.å…ˆæŒ‚èµ·çº¿ç¨‹Aï¼Œå°†å…¶åœ¨cpuä¸­çš„çŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚

2.åœ¨å†…å­˜ä¸­æ£€ç´¢ä¸‹ä¸€ä¸ªçº¿ç¨‹Bçš„ä¸Šä¸‹æ–‡å¹¶å°†å…¶åœ¨ CPU çš„å¯„å­˜å™¨ä¸­æ¢å¤,æ‰§è¡ŒBçº¿ç¨‹ã€‚

3.å½“Bæ‰§è¡Œå®Œï¼Œæ ¹æ®ç¨‹åºè®¡æ•°å™¨ä¸­æŒ‡å‘çš„ä½ç½®æ¢å¤çº¿ç¨‹Aã€‚

CPUé€šè¿‡ä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´ç‰‡æ¥å®ç°å¤šçº¿ç¨‹æœºåˆ¶ã€‚CPUé€šè¿‡æ—¶é—´ç‰‡åˆ†é…ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚

ä½†æ˜¯ï¼Œåœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå¯ä»¥å†åŠ è½½è¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€ã€‚æ‰€ä»¥ä»»åŠ¡ä»ä¿å­˜åˆ°å†åŠ è½½çš„è¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚

ä¸Šä¸‹æ–‡åˆ‡æ¢é€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹çš„ï¼Œæ„å‘³ç€æ­¤æ“ä½œä¼š**æ¶ˆè€—å¤§é‡çš„ CPU æ—¶é—´ï¼Œæ•…çº¿ç¨‹ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½**ã€‚å¦‚ä½•å‡å°‘ç³»ç»Ÿä¸­ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼Œæ˜¯æå‡å¤šçº¿ç¨‹æ€§èƒ½çš„ä¸€ä¸ªé‡ç‚¹è¯¾é¢˜ã€‚



## çº¿ç¨‹çš„åˆ›å»º

### çº¿ç¨‹åˆ›å»ºçš„ä¸‰ç§æ–¹å¼

1. ç»§æ‰¿Thread
2. å®ç°Runnable (æ”¯æŒlambdaè¡¨è¾¾å¼)
3. çº¿ç¨‹æ± ï¼Œå®ç°Callable(å¸¦è¿”å›å€¼ å’Œ å°è¯•å–æ¶ˆ)



ç»§æ‰¿Thread

```java
class ThreadA extends Thread{
    @Override
    public void run() {

        System.out.println("Thread A");
    }
}

public static void main(String[] args) {
    Thread a = new ThreadA();
    a.start();
}
```



å®ç°Runnable (æ”¯æŒlambdaè¡¨è¾¾å¼)

```java
/**
 * Runnable ç¤ºä¾‹
 */
class ThreadB implements Runnable {

    @Override
    public void run() {
        System.out.println("Thread B");
    }
}

public class RunnableDemo  {

    public static void main(String[] args) {
        /**
         * public
         * class Thread implements Runnable {
         * }
         */
        Thread b = new Thread(new ThreadB(), "Thread B");
        b.start();

        // Java8
        new Thread(() -> {
            System.out.println("Java8 Thread B");
        }).start();
    }
}
```



å®ç°Callable

```java
/**
 * public interface Callable<V> {}
 * å¯æŒ‡å®šcall()è¿”å›ç±»å‹
 */
class ThreadC implements Callable {

    @Override
    public Object call() throws Exception {
        System.out.println("Thead C");
        return Thread.currentThread().getName();
    }
}

public static void main(String[] args) throws ExecutionException, InterruptedException {
    // ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± ï¼Œä½†æ˜¯é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸å»ºè®®ä½¿ç”¨
    // åŸå› æ˜¯ä¸ºäº†è§„é¿èµ„æºè€—å°½é£é™©ï¼Œä¹Ÿè®©å¼€å‘è€…æ›´äº†è§£çº¿ç¨‹æ± è§„åˆ™
    ExecutorService executorService = Executors.newCachedThreadPool();

    ThreadC c = new ThreadC();
    // å¸¦è¿”å›ç»“æœçš„

    Future result = executorService.submit(c);
    // æ³¨æ„è°ƒç”¨getæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°å¾—åˆ°ç»“æœ
    // ç”¨é€”ï¼šé˜»å¡ï¼Œä¸€ç›´åˆ°çº¿ç¨‹ç»“æŸï¼Œå¸¸ç”¨äºçº¿ç¨‹æ± 
    result.get();
}
```



### Threadç±»ä¸Runnableæ¥å£çš„ä¼˜åŠ£æ¯”è¾ƒ

- Javaæ˜¯â€å•ç»§æ‰¿ï¼Œå¤šå®ç°â€œï¼Œå› æ­¤Runnableæ›´è½»é‡ï¼Œæ›´çµæ´»ï¼Œæ›´ç¬¦åˆé¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚åŒæ—¶é™ä½äº†çº¿ç¨‹å¯¹è±¡å’Œçº¿ç¨‹ä»»åŠ¡çš„è€¦åˆæ€§
- æ¨èä½¿ç”¨Runnable



### Future å’Œ FutureTask

- é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨Runnableå’ŒThreadæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚ä½†æ˜¯å®ƒä»¬æœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œå°±æ˜¯runæ–¹æ³•æ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚è€Œæœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›å¼€å¯ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆåæœ‰ä¸€ä¸ªè¿”å›å€¼ã€‚
- Futureåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œå®ƒé‡Œé¢çš„cancelï¼Œgetï¼ŒisDoneç­‰æ–¹æ³•è¦è‡ªå·±å®ç°èµ·æ¥éƒ½æ˜¯éå¸¸å¤æ‚çš„ã€‚æ‰€ä»¥JDKæä¾›äº†ä¸€ä¸ªFutureTaskç±»æ¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚
- å¾ˆå¤šé«˜å¹¶å‘çš„ç¯å¢ƒä¸‹ï¼Œæœ‰å¯èƒ½Callableå’ŒFutureTaskä¼šåˆ›å»ºå¤šæ¬¡ã€‚**FutureTaskèƒ½å¤Ÿåœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ç¡®ä¿ä»»åŠ¡åªæ‰§è¡Œä¸€æ¬¡**



## çº¿ç¨‹ç»„å’Œçº¿ç¨‹ä¼˜å…ˆçº§



### çº¿ç¨‹ç»„(ThreadGroup)

Javaä¸­ç”¨ThreadGroupæ¥è¡¨ç¤ºçº¿ç¨‹ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çº¿ç¨‹ç»„å¯¹çº¿ç¨‹è¿›è¡Œæ‰¹é‡æ§åˆ¶ã€‚



ThreadGroupå’ŒThreadçš„å…³ç³»å°±å¦‚åŒä»–ä»¬çš„å­—é¢æ„æ€ä¸€æ ·ç®€å•ç²—æš´ï¼Œæ¯ä¸ªThreadå¿…ç„¶å­˜åœ¨äºä¸€ä¸ªThreadGroupä¸­ï¼ŒThreadä¸èƒ½ç‹¬ç«‹äºThreadGroupå­˜åœ¨ã€‚æ‰§è¡Œmain()æ–¹æ³•çº¿ç¨‹çš„åå­—æ˜¯mainï¼Œå¦‚æœåœ¨new Threadæ—¶æ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œ**é‚£ä¹ˆé»˜è®¤å°†çˆ¶çº¿ç¨‹ï¼ˆå½“å‰æ‰§è¡Œnew Threadçš„çº¿ç¨‹ï¼‰**çº¿ç¨‹ç»„è®¾ç½®ä¸ºè‡ªå·±çš„çº¿ç¨‹ç»„ã€‚



### çº¿ç¨‹ä¼˜å…ˆçº§

Javaä¸­çº¿ç¨‹ä¼˜å…ˆçº§å¯ä»¥æŒ‡å®šï¼ŒèŒƒå›´æ˜¯1~10ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒ10çº§ä¼˜å…ˆçº§çš„åˆ’åˆ†ï¼ˆæ¯”å¦‚æœ‰äº›æ“ä½œç³»ç»Ÿåªæ”¯æŒ3çº§åˆ’åˆ†ï¼šä½ï¼Œä¸­ï¼Œé«˜ï¼‰ï¼ŒJavaåªæ˜¯ç»™æ“ä½œç³»ç»Ÿä¸€ä¸ªä¼˜å…ˆçº§çš„**å‚è€ƒå€¼**ï¼Œçº¿ç¨‹æœ€ç»ˆ**åœ¨æ“ä½œç³»ç»Ÿçš„ä¼˜å…ˆçº§**æ˜¯å¤šå°‘è¿˜æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚



æ—¢ç„¶æœ‰1-10çš„çº§åˆ«æ¥è®¾å®šäº†çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼Œè¿™æ—¶å€™å¯èƒ½æœ‰äº›è¯»è€…ä¼šé—®ï¼Œé‚£ä¹ˆæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥åœ¨ä¸šåŠ¡å®ç°çš„æ—¶å€™ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ³•æ¥æŒ‡å®šä¸€äº›çº¿ç¨‹æ‰§è¡Œçš„å…ˆåé¡ºåºï¼Ÿ



å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„ç­”æ¡ˆæ˜¯:No!

Javaä¸­çš„ä¼˜å…ˆçº§æ¥è¯´ä¸æ˜¯ç‰¹åˆ«çš„å¯é ï¼Œ**Javaç¨‹åºä¸­å¯¹çº¿ç¨‹æ‰€è®¾ç½®çš„ä¼˜å…ˆçº§åªæ˜¯ç»™æ“ä½œç³»ç»Ÿä¸€ä¸ªå»ºè®®ï¼Œæ“ä½œç³»ç»Ÿä¸ä¸€å®šä¼šé‡‡çº³ã€‚è€ŒçœŸæ­£çš„è°ƒç”¨é¡ºåºï¼Œæ˜¯ç”±æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹è°ƒåº¦ç®—æ³•å†³å®šçš„**ã€‚



### å®ˆæŠ¤çº¿ç¨‹

å¦‚æœæŸçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œé‚£å¦‚æœæ‰€æœ‰çš„éå®ˆæŠ¤çº¿ç¨‹ç»“æŸï¼Œè¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹ä¹Ÿä¼šè‡ªåŠ¨ç»“æŸã€‚



æˆ‘ä»¬æœ‰è°ˆåˆ°ä¸€ä¸ªçº¿ç¨‹å¿…ç„¶å­˜åœ¨äºä¸€ä¸ªçº¿ç¨‹ç»„ä¸­ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹å’Œçº¿ç¨‹ç»„çš„ä¼˜å…ˆçº§ä¸ä¸€è‡´çš„æ—¶å€™å°†ä¼šæ€æ ·å‘¢

æ‰€ä»¥ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹ä¼˜å…ˆçº§å¤§äºçº¿ç¨‹æ‰€åœ¨**çº¿ç¨‹ç»„çš„æœ€å¤§ä¼˜å…ˆçº§**ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹çš„ä¼˜å…ˆçº§å°†ä¼šå¤±æ•ˆï¼Œå–è€Œä»£ä¹‹çš„æ˜¯çº¿ç¨‹ç»„çš„æœ€å¤§ä¼˜å…ˆçº§ã€‚





## çº¿ç¨‹ä¸­çš„å„ç§æ–¹æ³•è§£é‡Š

- sleep()
- yield()
- join



### sleep()

ç¡çœ ï¼Œå›åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œ**å°±ç»ªçŠ¶æ€**ã€‚

sleep(long)â½…æ³•ä»…é‡Šæ”¾CPUä½¿â½¤æƒï¼Œé”ä»ç„¶å â½¤ï¼›çº¿ç¨‹è¢«æ”¾â¼Šè¶…æ—¶ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸yieldç›¸â½ï¼Œå®ƒä¼šä½¿çº¿ç¨‹è¾ƒâ»“æ—¶é—´å¾—ä¸åˆ°è¿â¾ã€‚



### yield()

æ”¾å¼ƒï¼Œå›åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼Œ**å°±ç»ªçŠ¶æ€**ã€‚

yield()â½…æ³•ä»…é‡Šæ”¾CPUæ‰§â¾æƒï¼Œé”ä»ç„¶å â½¤ï¼Œçº¿ç¨‹ä¼šè¢«æ”¾â¼Šå°±ç»ªé˜Ÿåˆ—ï¼Œä¼šåœ¨çŸ­æ—¶é—´å†…å†æ¬¡æ‰§â¾ã€‚

æ³¨ï¼šä½¿ç”¨åœºæ™¯å¾ˆå°‘ï¼ŒåŸºæœ¬ä¸ä½¿ç”¨



### join()

**ç­‰å¾…joinçš„è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå†ç»§ç»­æ‰§è¡Œå½“å‰çº¿ç¨‹ã€‚**

é€šå¸¸ç”¨æ¥ç­‰å¾…å¦å¤–ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šä¿è¯çº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚



ç¤ºä¾‹ï¼š

ä¸‹é¢ç¨‹åºä¸­ï¼ŒThreadAçº¿ç¨‹è¿›è¡Œäº†sleepï¼Œå¦‚æœä¸è°ƒç”¨`thread.join();`é‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œmainç¨‹åºã€‚

é€šè¿‡joinæ–¹æ³•ï¼Œmainç¨‹åºå°±ä¼šç­‰å¾…TheadAçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åå†ç»§ç»­æ‰§è¡Œã€‚

```Java
/**
 * join() ç¤ºä¾‹
 *
 * åº•å±‚è°ƒç”¨çš„è¿˜æ˜¯wait()
 */
public class JoinDemo {

    public static void main(String[] args) throws InterruptedException{
        Thread thread = new Thread(new ThreadA());
        thread.start();
        // å¦‚æœæ— ï¼Œä¼šå…ˆæ‰“å°----ç­‰å¾…çº¿ç¨‹ threadæ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œå½“å‰çº¿ç¨‹ è¿™å¥è¯
        thread.join();
        System.out.println("ç­‰å¾…çº¿ç¨‹ threadæ‰§è¡Œå®Œæ¯•ï¼Œå†æ‰§è¡Œå½“å‰çº¿ç¨‹ è¿™å¥è¯");
    }

    static class ThreadA implements Runnable{
        @Override
        public void run() {
            try{
                System.out.println("æˆ‘æ˜¯å­çº¿ç¨‹ï¼Œæˆ‘å…ˆç¡ä¸€ç§’");
                Thread.sleep(1000L);
                System.out.println("æˆ‘æ˜¯å­çº¿ç¨‹ï¼Œæˆ‘ç¡å®Œäº†ä¸€ç§’");
            }catch (InterruptedException e){
                e.printStackTrace();
            }
        }
    }
}

```



### interrupt()

çº¿ç¨‹ä¸­æ–­ã€‚ç›®å‰åœ¨Javaé‡Œè¿˜æ²¡æœ‰å®‰å…¨ç›´æ¥çš„æ–¹æ³•æ¥åœæ­¢çº¿ç¨‹ï¼Œä½†æ˜¯Javaæä¾›äº†çº¿ç¨‹ä¸­æ–­æœºåˆ¶æ¥å¤„ç†éœ€è¦ä¸­æ–­çº¿ç¨‹çš„æƒ…å†µã€‚

ä½¿ç”¨çš„åœºæ™¯å¾ˆå°‘ï¼Œå¾ˆå°‘ç”¨æ¥æ§åˆ¶ä¸šåŠ¡é€»è¾‘ã€‚



å¦‚ä½•æ­£å¸¸å…³é—­çº¿ç¨‹ï¼Ÿ

ä¸è¦å»ç”¨stop()ï¼Œè®©çº¿ç¨‹æ­£å¸¸ç»“æŸï¼Œä¹Ÿå°±æ˜¯run()æ–¹æ³•æ­£å¸¸ç»“æŸå³å¯ã€‚ä½¿ç”¨çº¿ç¨‹ä¸­æ–­å¯èƒ½ä¼šå¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚



### çº¿ç¨‹ä¸­çš„å„ç§æ–¹æ³•ä½¿ç”¨ç¤ºä¾‹

```java
/**
 * Threadä¸€äº›æ–¹æ³• ç¤ºä¾‹
 */
public class ThreadMethodDemo {

    public static void main(String[] args) throws InterruptedException{
        // è¿”å›å¯¹å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼›nativeæ–¹æ³•
        Thread currentThread =
                Thread.currentThread();

                // å¯åŠ¨ï¼ŒåŠ äº†synchronized
                currentThread.start();
                // æ”¾å¼ƒï¼Œè®©å‡ºä¸€æ®µæ—¶é—´CPU
                currentThread.yield();
                // ç¡çœ ï¼Œä½¿å½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´ï¼Œä¼šé‡Šæ”¾CPUèµ„æºï¼Œä½†ä¸é‡Šæ”¾é”
                Thread.sleep(1);
                // ç­‰å¾…åŠ å…¥ï¼Œå½“å‰çº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åå†ç»§ç»­æ‰§è¡Œ
                currentThread.join();

                // è®¾ç½®ä¼˜å…ˆçº§
                currentThread.setPriority(2);
                // è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹
                currentThread.setDaemon(true);
                // æ˜¯å¦ä¸­æ–­
                currentThread.isInterrupted();
                // å°è¯•ä¸­æ–­
                currentThread.interrupt();

    }
}
```



```java
wait / notify / notifyAll
Object
// ä¼šé‡Šæ”¾CPUèµ„æºï¼Œä¼šé‡Šæ”¾é”
// å®ƒä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„Javaæ–¹æ³•ï¼Œè€Œæ˜¯å®šä¹‰åœ¨Objectç±»çš„ä¸€ä¸ªnativeæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ç”±JVMçš„Cä»£ç å®ç°çš„ã€‚å…¶æ¬¡ï¼Œå¿…é¡»åœ¨synchronizedå—ä¸­æ‰èƒ½è°ƒç”¨wait()æ–¹æ³•
public final native void wait(long timeout) throws InterruptedException;

// å»ºè®®æ˜¯è°ƒç”¨ï¼šthis.notifyAll()è€Œä¸æ˜¯this.notify()ï¼Œ
// å› ä¸ºä½¿ç”¨notifyAll()å°†å”¤é†’æ‰€æœ‰å½“å‰æ­£åœ¨thisé”ç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œnotify()åªä¼šå”¤é†’å…¶ä¸­ä¸€ä¸ªï¼ˆå…·ä½“å“ªä¸ªä¾èµ–æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸€å®šçš„éšæœºæ€§ï¼‰
public final native void notify();
```



**è·å–å½“å‰æ–¹æ³•çš„åç§°**

```
Thread.currentThread().getStackTrace()[1].getMethodName()
```



### sleep() å’Œwait()å¯¹æ¯”

- waitå¯ä»¥æŒ‡å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šï¼›è€Œsleepå¿…é¡»æŒ‡å®šæ—¶é—´ã€‚
- waité‡Šæ”¾cpuèµ„æºï¼ŒåŒæ—¶é‡Šæ”¾é”ï¼›sleepé‡Šæ”¾cpuèµ„æºï¼Œä½†æ˜¯ä¸é‡Šæ”¾é”ï¼Œæ‰€ä»¥æ˜“æ­»é”ã€‚
- waitå¿…é¡»æ”¾åœ¨åŒæ­¥å—æˆ–åŒæ­¥æ–¹æ³•ä¸­ï¼Œè€Œsleepå¯ä»¥å†ä»»æ„ä½ç½®



æœ€â¼¤çš„ä¸åŒæ˜¯åœ¨ç­‰å¾…æ—¶waitä¼šé‡Šæ”¾é”ï¼Œâ½½sleepâ¼€ç›´æŒæœ‰é”ã€‚

- wait()â½…æ³•ä¼šé‡Šæ”¾CPUæ‰§â¾æƒ å’Œ å æœ‰çš„é”ã€‚
- sleep(long)â½…æ³•ä»…é‡Šæ”¾CPUä½¿â½¤æƒï¼Œé”ä»ç„¶å â½¤ï¼›çº¿ç¨‹è¢«æ”¾â¼Šè¶…æ—¶ç­‰å¾…é˜Ÿåˆ—ï¼Œä¸yieldç›¸â½ï¼Œå®ƒä¼šä½¿çº¿ç¨‹è¾ƒâ»“æ—¶é—´å¾—ä¸åˆ°è¿ â¾ã€‚
- yield()â½…æ³•ä»…é‡Šæ”¾CPUæ‰§â¾æƒï¼Œé”ä»ç„¶å â½¤ï¼Œçº¿ç¨‹ä¼šè¢«æ”¾â¼Šå°±ç»ªé˜Ÿåˆ—ï¼Œä¼šåœ¨çŸ­æ—¶é—´å†…å†æ¬¡æ‰§â¾
- waitå’Œnotifyå¿…é¡»é…å¥—ä½¿â½¤ï¼Œå³å¿…é¡»ä½¿â½¤åŒâ¼€æŠŠé”è°ƒâ½¤
- waitå’Œnotifyå¿…é¡»æ”¾åœ¨â¼€ä¸ªåŒæ­¥å—ä¸­è°ƒâ½¤waitå’Œnotifyçš„å¯¹è±¡å¿…é¡»æ˜¯ä»–ä»¬æ‰€å¤„åŒæ­¥å—çš„é”å¯¹è±¡ã€‚



## çº¿ç¨‹ä¸­çš„å„ç§çŠ¶æ€è§£é‡Š

- NEWï¼š æ–°å»ºçŠ¶æ€ï¼Œè¿˜æœªè°ƒç”¨start()
- RUNNABLEï¼šæ­£åœ¨è¿è¡ŒçŠ¶æ€ï¼Œæ­£åœ¨è¿è¡Œrun()ï¼ŒRUNNABLEåŒ…æ‹¬äº†ä¼ ç»Ÿæ“ä½œç³»ç»Ÿçº¿ç¨‹çš„readyï¼ˆ**å°±ç»ªçŠ¶æ€**ï¼‰å’Œrunningï¼ˆè¿è¡ŒçŠ¶æ€ï¼‰ä¸¤ä¸ªçŠ¶æ€çš„
- BLOCKEDï¼šé˜»å¡çŠ¶æ€ï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œè¢«é˜»å¡è€ŒæŒ‚èµ·ã€‚ä¾‹å¦‚ï¼šåŠ äº†synchronizedï¼Œæ²¡å¾—åˆ°é”çš„æ—¶å€™ä¼šè¿›è¡Œé˜»å¡ã€‚
- WAITINGï¼šç­‰å¾…çŠ¶æ€ï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæŸäº›æ“ä½œåœ¨ç­‰å¾…ä¸­
- TIMED_WAITINGï¼šè¶…æ—¶ç­‰å¾…çŠ¶æ€ï¼Œè¿è¡Œä¸­çš„çº¿ç¨‹ï¼Œå› ä¸ºæ‰§è¡Œsleep()æ–¹æ³•æ­£åœ¨è®¡æ—¶ç­‰å¾…ï¼Œä¸WAITINGç›¸æ¯”å¤šäº†æ—¶é•¿è®¾ç½®ã€‚
- TERMINATEDï¼šçº¿ç¨‹å·²ç»ˆæ­¢ï¼Œå› ä¸ºrun()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œå®Œäº†å°±ç»“æŸäº†



> ä¾‹å¦‚ï¼šä»Šå¤©ä½ ä¸‹ç­åå‡†å¤‡å»é£Ÿå ‚åƒé¥­ã€‚ä½ æ¥åˆ°é£Ÿå ‚**ä»…æœ‰çš„ä¸€ä¸ªçª—å£**ï¼Œå‘ç°å‰é¢å·²ç»æœ‰ä¸ªäººåœ¨çª—å£å‰äº†ï¼Œæ­¤æ—¶ä½ å¿…é¡»å¾—ç­‰å‰é¢çš„äººä»çª—å£ç¦»å¼€æ‰è¡Œã€‚
>
> å‡è®¾ä½ æ˜¯çº¿ç¨‹t2ï¼Œä½ å‰é¢çš„é‚£ä¸ªäººæ˜¯çº¿ç¨‹t1ã€‚æ­¤æ—¶t1**å æœ‰äº†é”**ï¼ˆé£Ÿå ‚å”¯ä¸€çš„çª—å£ï¼‰ï¼Œt2æ­£åœ¨ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œæ‰€ä»¥æ­¤æ—¶t2å°±å¤„äºBLOCKEDçŠ¶æ€ã€‚

æ³¨ï¼šå½“æ²¡è·å–åˆ°é”ï¼Œç­‰å¾…é”æ—¶å°±å¤„äºBLOCKEDï¼Œé˜»å¡çŠ¶æ€ã€‚



> ä½ ç­‰äº†å¥½å‡ åˆ†é’Ÿç°åœ¨ç»ˆäºè½®åˆ°ä½ äº†ï¼Œçªç„¶ä½ ä»¬æœ‰ä¸€ä¸ªâ€œä¸æ‡‚äº‹â€çš„ç»ç†çªç„¶æ¥äº†ã€‚ä½ çœ‹åˆ°ä»–ä½ å°±æœ‰ä¸€ç§ä¸ç¥¥çš„é¢„æ„Ÿï¼Œæœç„¶ï¼Œä»–æ˜¯æ¥æ‰¾ä½ çš„ã€‚
>
> ä»–æŠŠä½ æ‹‰åˆ°ä¸€æ—å«ä½ å¾…ä¼šå„¿å†åƒé¥­ï¼Œè¯´ä»–ä¸‹åˆè¦å»ä½œæŠ¥å‘Šï¼Œèµ¶ç´§æ¥æ‰¾ä½ äº†è§£ä¸€ä¸‹é¡¹ç›®çš„æƒ…å†µã€‚ä½ å¿ƒé‡Œè™½ç„¶æœ‰ä¸€ä¸‡ä¸ªä¸æ„¿æ„ä½†æ˜¯ä½ è¿˜æ˜¯ä»é£Ÿå ‚çª—å£èµ°å¼€äº†ã€‚
>
> æ­¤æ—¶ï¼Œå‡è®¾ä½ è¿˜æ˜¯çº¿ç¨‹t2ï¼Œä½ çš„ç»ç†æ˜¯çº¿ç¨‹t1ã€‚**è™½ç„¶ä½ æ­¤æ—¶éƒ½å æœ‰é”**ï¼ˆçª—å£ï¼‰äº†ï¼Œâ€œä¸é€Ÿä¹‹å®¢â€æ¥äº†ä½ è¿˜æ˜¯å¾—**é‡Šæ”¾æ‰é”**ã€‚æ­¤æ—¶ä½ t2çš„çŠ¶æ€å°±æ˜¯WAITINGã€‚
>
> ç„¶åç»ç†t1è·å¾—é”ï¼Œè¿›å…¥RUNNABLEçŠ¶æ€ã€‚

> è¦æ˜¯ç»ç†t1ä¸ä¸»åŠ¨å”¤é†’ä½ t2ï¼ˆnotifyã€notifyAll..ï¼‰ï¼Œå¯ä»¥è¯´ä½ t2åªèƒ½ä¸€ç›´ç­‰å¾…äº†ã€‚

æ³¨ï¼šå½“è°ƒç”¨`Object.wait()ã€Thread.join()ã€LockSupport.park()`æ—¶ï¼Œå°±å¿…é¡»å¾—é‡Šæ”¾é”ï¼Œè¿›è¡Œç­‰å¾…ã€‚æ­¤æ—¶**éœ€è¦ä¸»åŠ¨å”¤é†’**ï¼Œä¸ç„¶ä¼šä¸€ç›´ç­‰å¾…ã€‚



>  åˆ°äº†ç¬¬äºŒå¤©ä¸­åˆï¼Œåˆåˆ°äº†é¥­ç‚¹ï¼Œä½ è¿˜æ˜¯åˆ°äº†çª—å£å‰ã€‚
>
> çªç„¶é—´æƒ³èµ·ä½ çš„åŒäº‹å«ä½ ç­‰ä»–ä¸€èµ·ï¼Œä»–è¯´è®©ä½ ç­‰ä»–ååˆ†é’Ÿä»–æ”¹ä¸ªbugã€‚
>
> å¥½å§ï¼Œä½ è¯´é‚£ä½ å°±ç­‰ç­‰å§ï¼Œä½ å°±ç¦»å¼€äº†çª—å£ã€‚
>
> å¾ˆ**å¿«ååˆ†é’Ÿè¿‡å»äº†ï¼Œä½ è§ä»–è¿˜æ²¡æ¥ï¼Œä½ æƒ³éƒ½ç­‰äº†è¿™ä¹ˆä¹…äº†è¿˜ä¸æ¥ï¼Œé‚£ä½ è¿˜æ˜¯å…ˆå»åƒé¥­å¥½äº†ã€‚**
>
> è¿™æ—¶ä½ è¿˜æ˜¯çº¿ç¨‹t1ï¼Œä½ æ”¹bugçš„åŒäº‹æ˜¯çº¿ç¨‹t2ã€‚t2è®©t1ç­‰å¾…äº†æŒ‡å®šæ—¶é—´ï¼Œæ­¤æ—¶t1ç­‰å¾…æœŸé—´å°±å±äºTIMED_WATINGçŠ¶æ€ã€‚

> t1ç­‰å¾…10åˆ†é’Ÿåï¼Œå°±è‡ªåŠ¨å”¤é†’ï¼Œæ‹¥æœ‰äº†å»äº‰å¤ºé”çš„èµ„æ ¼ã€‚

æ³¨ï¼šä¸WAITINGç›¸æ¯”ï¼Œå¤šäº†ç­‰å¾…æ—¶é•¿è®¾ç½®ï¼Œåˆ°äº†ä¸€å®šæ—¶é—´ä¼š**è‡ªåŠ¨å”¤é†’**ã€‚ä¹Ÿå¯ä»¥æ‰‹åŠ¨å”¤é†’ã€‚



### çº¿ç¨‹çŠ¶æ€è½¬æ¢å›¾

![image.png](H:/akane-note/ğŸ°ç¼–ç¨‹è¯­è¨€/Java/images/java5.png)

![image.png](H:/akane-note/ğŸ°ç¼–ç¨‹è¯­è¨€/Java/images/java6.png)









